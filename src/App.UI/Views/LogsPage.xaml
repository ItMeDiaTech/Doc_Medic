<UserControl x:Class="App.UI.Views.LogsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <Style x:Key="LogLevelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="MinWidth" Value="40" />
            <Setter Property="TextAlignment" Value="Center" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding Level}" Value="ERR">
                    <Setter Property="Foreground" Value="#F44336" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Level}" Value="WRN">
                    <Setter Property="Foreground" Value="#FF9800" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Level}" Value="INF">
                    <Setter Property="Foreground" Value="#4CAF50" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Level}" Value="DBG">
                    <Setter Property="Foreground" Value="#2196F3" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <DataTemplate x:Key="LogEntryTemplate">
            <Border BorderThickness="0,0,0,1" 
                    BorderBrush="{DynamicResource MaterialDesignDivider}"
                    Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Timestamp -->
                    <TextBlock Grid.Column="0" 
                             Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss.fff}'}"
                             Style="{DynamicResource MaterialDesignCaptionTextBlock}"
                             VerticalAlignment="Top"
                             Opacity="0.7" />

                    <!-- Level -->
                    <Border Grid.Column="1" 
                          Background="{Binding LevelColor}"
                          CornerRadius="8"
                          Padding="4,2"
                          Margin="4,0"
                          VerticalAlignment="Top">
                        <TextBlock Text="{Binding Level}" 
                                 Foreground="White"
                                 FontSize="10"
                                 FontWeight="Medium"
                                 HorizontalAlignment="Center" />
                    </Border>

                    <!-- Message -->
                    <TextBlock Grid.Column="2" 
                             Text="{Binding Message}"
                             Style="{DynamicResource MaterialDesignBody2TextBlock}"
                             TextWrapping="Wrap"
                             VerticalAlignment="Top"
                             Margin="8,0,0,0" />
                </Grid>
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:Card Grid.Row="0" Style="{StaticResource SectionCardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Application Logs" 
                             Style="{DynamicResource MaterialDesignHeadline5TextBlock}" />
                    <TextBlock Text="{Binding LogFilePath, StringFormat='Monitoring: {0}'}" 
                             Style="{DynamicResource MaterialDesignBody2TextBlock}"
                             Opacity="0.7" Margin="0,4,0,0" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Refresh" 
                          Style="{DynamicResource MaterialDesignOutlinedButton}"
                          Command="{Binding RefreshLogsCommand}"
                          Margin="0,0,8,0">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Refresh" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <Button Content="Export" 
                          Style="{DynamicResource MaterialDesignOutlinedButton}"
                          Command="{Binding ExportLogsCommand}"
                          Margin="0,0,8,0">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Export" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <Button Content="Clear" 
                          Style="{DynamicResource MaterialDesignOutlinedButton}"
                          Command="{Binding ClearLogsCommand}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Close" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Filters -->
        <materialDesign:Card Grid.Row="1" Style="{StaticResource SectionCardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="200" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Log Level Filter -->
                <TextBlock Grid.Column="0" 
                         Text="Level:" 
                         VerticalAlignment="Center" 
                         Margin="0,0,8,0" />
                
                <ComboBox Grid.Column="1" 
                        ItemsSource="{Binding LogLevels}"
                        SelectedItem="{Binding SelectedLogLevel}"
                        Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                        Margin="0,0,16,0" />

                <!-- Text Filter -->
                <TextBox Grid.Column="2" 
                       Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                       Style="{DynamicResource MaterialDesignOutlinedTextBox}"
                       materialDesign:HintAssist.Hint="Filter messages..."
                       Margin="0,0,16,0" />

                <!-- Auto-scroll Toggle -->
                <CheckBox Grid.Column="3"
                        Content="Auto-scroll" 
                        IsChecked="{Binding AutoScroll}"
                        Style="{DynamicResource MaterialDesignCheckBox}" />
            </Grid>
        </materialDesign:Card>

        <!-- Log Entries -->
        <materialDesign:Card Grid.Row="2" Style="{StaticResource SectionCardStyle}" Padding="0">
            <Grid>
                <!-- Empty State -->
                <StackPanel HorizontalAlignment="Center" 
                          VerticalAlignment="Center"
                          Opacity="0.6"
                          Visibility="{Binding LogEntries.Count, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=0}">
                    <materialDesign:PackIcon Kind="FileDocument" 
                                           Width="64" Height="64" 
                                           HorizontalAlignment="Center" />
                    <TextBlock Text="No log entries found" 
                             Style="{DynamicResource MaterialDesignHeadline6TextBlock}"
                             HorizontalAlignment="Center" Margin="0,16,0,8" />
                    <TextBlock Text="Application logs will appear here automatically" 
                             Style="{DynamicResource MaterialDesignBody2TextBlock}"
                             HorizontalAlignment="Center" 
                             TextAlignment="Center" />
                </StackPanel>

                <!-- Log Entries List -->
                <ScrollViewer x:Name="LogScrollViewer"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Disabled"
                            Visibility="{Binding LogEntries.Count, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                            x:FieldModifier="public">

                    <ItemsControl ItemsSource="{Binding LogEntries}"
                                ItemTemplate="{StaticResource LogEntryTemplate}"
                                Background="Transparent">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel VirtualizationMode="Recycling" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </materialDesign:Card>
    </Grid>
</UserControl>
<UserControl x:Class="App.UI.Views.HomePage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:models="clr-namespace:App.UI.Models"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <!-- Status to color converter -->
        <Style x:Key="StatusCellStyle" TargetType="DataGridCell">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Completed">
                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignValidationErrorBrush}" />
                    <Setter Property="Foreground" Value="Green" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Error">
                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignValidationErrorBrush}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Processing">
                    <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:Card Grid.Row="0" Style="{StaticResource SectionCardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Document Processing" 
                             Style="{DynamicResource MaterialDesignHeadline5TextBlock}" />
                    <TextBlock Text="Select Word documents (.docx) to format and fix hyperlinks" 
                             Style="{DynamicResource MaterialDesignBody2TextBlock}"
                             Opacity="0.7" Margin="0,4,0,0" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Select Files" 
                          Style="{DynamicResource MaterialDesignRaisedButton}"
                          Command="{Binding SelectFilesCommand}"
                          Margin="0,0,8,0">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="FolderOpen" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <Button Content="Clear All" 
                          Style="{DynamicResource MaterialDesignOutlinedButton}"
                          Command="{Binding ClearFilesCommand}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Close" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- File List with Drag & Drop -->
        <materialDesign:Card Grid.Row="1" Style="{StaticResource SectionCardStyle}"
                           AllowDrop="True"
                           Drop="UserControl_Drop"
                           DragOver="UserControl_DragOver">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Files Header -->
                <TextBlock Grid.Row="0" Text="Selected Files" 
                         Style="{DynamicResource MaterialDesignSubtitle1TextBlock}"
                         Margin="0,0,0,8" />

                <!-- Empty State -->
                <StackPanel Grid.Row="1" 
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Center"
                          Opacity="0.6"
                          Visibility="{Binding Files.Count, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=0}">
                    <materialDesign:PackIcon Kind="FilePlus" 
                                           Width="64" Height="64" 
                                           HorizontalAlignment="Center" />
                    <TextBlock Text="No files selected" 
                             Style="{DynamicResource MaterialDesignHeadline6TextBlock}"
                             HorizontalAlignment="Center" Margin="0,16,0,8" />
                    <TextBlock Text="Click 'Select Files' or drag and drop .docx files here" 
                             Style="{DynamicResource MaterialDesignBody2TextBlock}"
                             HorizontalAlignment="Center" 
                             TextAlignment="Center" />
                </StackPanel>

                <!-- Files DataGrid -->
                <DataGrid Grid.Row="1" 
                        ItemsSource="{Binding Files}"
                        Style="{StaticResource FileGridStyle}"
                        Visibility="{Binding Files.Count, Converter={StaticResource CountToVisibilityConverter}}"
                        x:Name="FilesDataGrid">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Name" 
                                          Binding="{Binding FileName}" 
                                          Width="*" MinWidth="200" />
                        
                        <DataGridTextColumn Header="Size" 
                                          Binding="{Binding SizeFormatted}" 
                                          Width="80" />
                        
                        <DataGridTextColumn Header="Modified" 
                                          Binding="{Binding LastModified, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" 
                                          Width="130" />
                        
                        <DataGridTextColumn Header="Status" 
                                          Binding="{Binding Status}" 
                                          Width="100"
                                          CellStyle="{StaticResource StatusCellStyle}" />
                        
                        <DataGridTextColumn Header="Changes" 
                                          Binding="{Binding Changes}" 
                                          Width="80" />

                        <DataGridTemplateColumn Header="Progress" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ProgressBar Value="{Binding Progress, Mode=OneWay}" 
                                               Maximum="100" 
                                               Height="20"
                                               Visibility="{Binding Status, Converter={StaticResource EqualityToVisibilityConverter}, ConverterParameter=Processing}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Actions" Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                          Command="{Binding DataContext.RemoveSelectedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                          CommandParameter="{Binding}"
                                          ToolTip="Remove file">
                                        <materialDesign:PackIcon Kind="Close" />
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </materialDesign:Card>

        <!-- Processing Options -->
        <materialDesign:Card Grid.Row="2" Style="{StaticResource SectionCardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,16,0">
                    <TextBlock Text="Processing Options" 
                             Style="{DynamicResource MaterialDesignSubtitle1TextBlock}"
                             Margin="0,0,0,12" />

                    <CheckBox Content="Replace double spaces with single spaces" 
                            IsChecked="{Binding CollapseDoubleSpaces}"
                            Style="{DynamicResource MaterialDesignCheckBox}"
                            Margin="0,0,0,8" />

                    <CheckBox Content="Fix 'Top of Document' links" 
                            IsChecked="{Binding FixTopOfDocLinks}"
                            Style="{DynamicResource MaterialDesignCheckBox}"
                            Margin="0,0,0,8" />
                </StackPanel>

                <StackPanel Grid.Column="1">
                    <TextBlock Text="Style Options" 
                             Style="{DynamicResource MaterialDesignSubtitle1TextBlock}"
                             Margin="0,0,0,12" />

                    <CheckBox Content="Standardize document styles" 
                            IsChecked="{Binding StandardizeStyles}"
                            Style="{DynamicResource MaterialDesignCheckBox}"
                            Margin="0,0,0,8" />

                    <CheckBox Content="Center all images" 
                            IsChecked="{Binding CenterImages}"
                            Style="{DynamicResource MaterialDesignCheckBox}"
                            Margin="0,0,0,8" />
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Processing Controls -->
        <materialDesign:Card Grid.Row="3" Style="{StaticResource SectionCardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Progress Bar -->
                <Grid Grid.Row="0" Margin="0,0,0,16"
                    Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="{Binding ProcessingStatus}" 
                                 Style="{DynamicResource MaterialDesignBody2TextBlock}" />
                        <TextBlock Text="{Binding OverallProgress, StringFormat='({0}%)'}" 
                                 Style="{DynamicResource MaterialDesignBody2TextBlock}"
                                 Margin="8,0,0,0" />
                    </StackPanel>

                    <ProgressBar Grid.Row="1" 
                               Value="{Binding OverallProgress, Mode=OneWay}" 
                               Maximum="100" 
                               Height="8"
                               Style="{DynamicResource MaterialDesignLinearProgressBar}" />
                </Grid>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Process Files" 
                          Style="{DynamicResource MaterialDesignRaisedButton}"
                          Command="{Binding ProcessFilesCommand}"
                          Margin="0,0,8,0"
                          IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Play" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <Button Content="Cancel" 
                          Style="{DynamicResource MaterialDesignOutlinedButton}"
                          Command="{Binding CancelProcessingCommand}"
                          Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Stop" 
                                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>
    </Grid>
</UserControl>